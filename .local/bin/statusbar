#!/bin/sh

bat() {
	bat="$(cat /sys/class/power_supply/BAT0/capacity)"
	case 1 in
		$((bat = 100)) ) icon="Û∞Åπ" ;;
		$((bat >= 90)) ) icon="Û∞ÇÇ" ;;
		$((bat >= 80)) ) icon="Û∞ÇÅ" ;;
		$((bat >= 70)) ) icon="Û∞ÇÄ" ;;
		$((bat >= 60)) ) icon="Û∞Åø" ;;
		$((bat >= 50)) ) icon="Û∞Åæ" ;;
		$((bat >= 40)) ) icon="Û∞ÅΩ" ;;
		$((bat >= 30)) ) icon="Û∞Åº" ;;
		$((bat >= 20)) ) icon="Û∞Åª" ;;
		$((bat >= 10)) ) icon="Û∞Å∫" ;;
		$((bat <= 10)) ) icon="Û∞ÇÉ" ;;
	esac
	[ "$bat" ] && printf " $icon  $bat%%"
}

clk() {
	clk="$(date '+%I')"
	case "$clk" in
		"00") icon="üïõ" ;;
		"01") icon="üïê" ;;
		"02") icon="üïë" ;;
		"03") icon="üïí" ;;
		"04") icon="üïì" ;;
		"05") icon="üïî" ;;
		"06") icon="üïï" ;;
		"07") icon="üïñ" ;;
		"08") icon="üïó" ;;
		"09") icon="üïò" ;;
		"10") icon="üïô" ;;
		"11") icon="üïö" ;;
		"12") icon="üïõ" ;;
	esac
	clk="$(date '+%H:%M')"
	printf " $icon  $clk"
}

cpu() {
	cpu="$(sed 's/000$/¬∞C/' /sys/class/thermal/thermal_zone0/temp)"
	[ "$cpu" ] && printf " Û∞îè  %s " "$cpu"
}

cut() {
	IFS=$2
	set -- $1
	printf '%s' "$@"
}

net() {
	net="$(iwctl station wlan0 show | grep "^\s*Connected network" | awk '{print $3}')"
	case "$(cat /sys/class/net/wl*/operstate 2>/dev/null)" in
		up   ) printf " Û∞§®  %s " "$net" ;;
		down ) printf " Û∞§≠  %s " "Disconnected" ;;
	esac
}

vol() {
	vol="$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
	vol="${vol#'Volume: '}"
	vol="${vol%' [MUTED]'}"
	vol="$(printf "%.0f" "$(cut "$vol" ".")")"
	case "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)" in
		*MUTED* ) printf " Û∞ùü  %s " "$vol" ;;
		*       ) printf " Û∞ïæ  %s " "$vol" ;;
	esac
}

while true; do
	sleep 0.5 && xprop -root -set WM_NAME "$(cpu) $(bat) $(net) $(vol) $(clk)"
done
