#!/bin/sh

bat() {
	bat="$(cat /sys/class/power_supply/BAT0/capacity)"
	case 1 in
		$((bat >= 99)) ) icon="󰁹" ;;
		$((bat >= 90)) ) icon="󰂂" ;;
		$((bat >= 80)) ) icon="󰂁" ;;
		$((bat >= 70)) ) icon="󰂀" ;;
		$((bat >= 60)) ) icon="󰁿" ;;
		$((bat >= 50)) ) icon="󰁾" ;;
		$((bat >= 40)) ) icon="󰁽" ;;
		$((bat >= 30)) ) icon="󰁼" ;;
		$((bat >= 20)) ) icon="󰁻" ;;
		$((bat >= 10)) ) icon="󰁺" ;;
		$((bat <= 10)) ) icon="󰂃" ;;
	esac
	[ "$bat" ] && printf " $icon "
}

clk() {
	clk="$(date '+%I')"
	case "$clk" in
		"00") icon="󱑊" ;;
		"01") icon="󱐿" ;;
		"02") icon="󱑀" ;;
		"03") icon="󱑁" ;;
		"04") icon="󱑂" ;;
		"05") icon="󱑃" ;;
		"06") icon="󱑄" ;;
		"07") icon="󱑅" ;;
		"08") icon="󱑆" ;;
		"09") icon="󱑇" ;;
		"10") icon="󱑈" ;;
		"11") icon="󱑉" ;;
		"12") icon="󱑊" ;;
	esac
	clk="$(date '+%H:%M')"
	printf " $icon  $clk "
}

cpu() {
	cpu="$(($(cat /sys/class/thermal/thermal_zone0/temp)/1000))"
	case 1 in
		$((cpu >= 80)) ) icon="󱃂" ;;
		$((cpu >= 40)) ) icon="󰔏" ;;
		$((cpu >= 20)) ) icon="󱃃" ;;
	esac
	[ "$cpu" ] && printf " $icon  $cpu°C "
}

cut() {
	IFS=$2
	set -- $1
	printf '%s' "$@"
}

ime() {
	ime="$(fcitx5-remote)"
	case 1 in
		$((ime == 1)) ) icon="" ;;
		$((ime == 2)) ) icon="" ;;
	esac
	[ "$ime" ] && printf " $icon "
}

net() {
	net="$(iwctl station wlan0 show | grep "^\s*RSSI" | awk '{print $2}')"
	case 1 in
		$((net >= -30)) ) icon="󰤨" ;;
		$((net >= -60)) ) icon="󰤥" ;;
		$((net >= -70)) ) icon="󰤢" ;;
		$((net >= -80)) ) icon="󰤟" ;;
		$((net >= -90)) ) icon="󰤯" ;;
	esac
	case "$(cat /sys/class/net/w*/operstate 2>/dev/null)" in
		up   ) printf " $icon " ;;
		down ) printf " 󰤮 " ;;
	esac
	case "$(cat /sys/class/net/e*/operstate 2>/dev/null)" in
		up   ) printf " 󰈀 " ;;
	esac
}

vol() {
	vol="$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
	vol="${vol#'Volume: '}"
	vol="${vol%' [MUTED]'}"
	vol="$(printf "%.0f" "$(cut "$vol" ".")")"
	case 1 in
		$((vol >= 80)) ) icon="󰕾" ;;
		$((vol >= 20)) ) icon="󰖀" ;;
		$((vol >= 0)) ) icon="󰕿" ;;
	esac
	case "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)" in
		*MUTED* ) printf " 󰝟 " ;;
		*       ) printf " $icon " ;;
	esac
}

while true; do
	sleep 0.5 && xprop -root -set WM_NAME "$(cpu) $(ime) $(bat) $(net) $(vol) $(clk)"
done
