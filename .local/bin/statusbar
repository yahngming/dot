#!/bin/sh

bat() {
	bat="$(cat /sys/class/power_supply/BAT0/capacity)"
	case 1 in
		$((bat >= 99)) ) icon="󰁹" ;;
		$((bat >= 90)) ) icon="󰂂" ;;
		$((bat >= 80)) ) icon="󰂁" ;;
		$((bat >= 70)) ) icon="󰂀" ;;
		$((bat >= 60)) ) icon="󰁿" ;;
		$((bat >= 50)) ) icon="󰁾" ;;
		$((bat >= 40)) ) icon="󰁽" ;;
		$((bat >= 30)) ) icon="󰁼" ;;
		$((bat >= 20)) ) icon="󰁻" ;;
		$((bat >= 10)) ) icon="󰁺" ;;
		$((bat <= 10)) ) icon="󰂃" ;;
	esac
	[ "$bat" ] && printf " $icon  $bat%% "
}

clk() {
	clk="$(date '+%I')"
	case "$clk" in
		"00") icon="󱑊" ;;
		"01") icon="󱐿" ;;
		"02") icon="󱑀" ;;
		"03") icon="󱑁" ;;
		"04") icon="󱑂" ;;
		"05") icon="󱑃" ;;
		"06") icon="󱑄" ;;
		"07") icon="󱑅" ;;
		"08") icon="󱑆" ;;
		"09") icon="󱑇" ;;
		"10") icon="󱑈" ;;
		"11") icon="󱑉" ;;
		"12") icon="󱑊" ;;
	esac
	clk="$(date '+%H:%M')"
	printf " $icon  $clk "
}

cpu() {
	cpu="$(($(cat /sys/class/thermal/thermal_zone0/temp)/1000))"
	case 1 in
		$((cpu >= 80)) ) icon="󱃂" ;;
		$((cpu >= 40)) ) icon="󰔏" ;;
		$((cpu >= 20)) ) icon="󱃃" ;;
	esac
	[ "$cpu" ] && printf " $icon  $cpu°C "
}

cut() {
	IFS=$2
	set -- $1
	printf '%s' "$@"
}

net() {
	net="$(iwctl station wlan0 show | grep "^\s*RSSI" | awk '{print $2}')"
	case 1 in
		$((net >= -30)) ) icon="󰤨" ;;
		$((net >= -60)) ) icon="󰤥" ;;
		$((net >= -70)) ) icon="󰤢" ;;
		$((net >= -80)) ) icon="󰤟" ;;
		$((net >= -90)) ) icon="󰤯" ;;
	esac
	net="$(iwctl station wlan0 show | grep "^\s*Connected network" | awk '{print $3}')"
	case "$(cat /sys/class/net/wl*/operstate 2>/dev/null)" in
		up   ) printf " $icon  $net " ;;
		down ) printf " 󰤮  Disconnected " ;;
	esac
}

vol() {
	vol="$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
	vol="${vol#'Volume: '}"
	vol="${vol%' [MUTED]'}"
	vol="$(printf "%.0f" "$(cut "$vol" ".")")"
	case "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)" in
		*MUTED* ) printf " 󰝟  %s " "$vol" ;;
		*       ) printf " 󰕾  %s " "$vol" ;;
	esac
}

while true; do
	sleep 0.5 && xprop -root -set WM_NAME "$(cpu) $(bat) $(net) $(vol) $(clk)"
done
