#!/bin/sh

bat() {
	bat="$(cat /sys/class/power_supply/BAT0/capacity)"
	case 1 in
		$((bat <= 10)) ) icon="Û∞ÇÉ" ;;
		$((bat <= 20)) ) icon="Û∞Å∫" ;;
		$((bat <= 30)) ) icon="Û∞Åª" ;;
		$((bat <= 40)) ) icon="Û∞Åº" ;;
		$((bat <= 50)) ) icon="Û∞ÅΩ" ;;
		$((bat <= 60)) ) icon="Û∞Åæ" ;;
		$((bat <= 70)) ) icon="Û∞Åø" ;;
		$((bat <= 80)) ) icon="Û∞ÇÄ" ;;
		$((bat <= 90)) ) icon="Û∞ÇÅ" ;;
		$((bat <= 99)) ) icon="Û∞ÇÇ" ;;
		$((bat >= 99)) ) icon="Û∞Åπ" ;;
	esac
	[ "$bat" ] && printf "$icon"
}

clk() {
	clk="$(date '+%I')"
	case "$clk" in
		"00" ) icon="Û±ëä" ;;
		"01" ) icon="Û±êø" ;;
		"02" ) icon="Û±ëÄ" ;;
		"03" ) icon="Û±ëÅ" ;;
		"04" ) icon="Û±ëÇ" ;;
		"05" ) icon="Û±ëÉ" ;;
		"06" ) icon="Û±ëÑ" ;;
		"07" ) icon="Û±ëÖ" ;;
		"08" ) icon="Û±ëÜ" ;;
		"09" ) icon="Û±ëá" ;;
		"10" ) icon="Û±ëà" ;;
		"11" ) icon="Û±ëâ" ;;
		"12" ) icon="Û±ëä" ;;
	esac
	clk="$(date '+%H:%M')"
	printf "$icon"
}

cpu() {
	cpu="$(($(cat /sys/class/thermal/thermal_zone0/temp)/1000))"
	case 1 in
		$((cpu <= 40)) ) icon="Û±ÉÉ" ;;
		$((cpu <= 80)) ) icon="Û∞îè" ;;
		$((cpu <= 99)) ) icon="Û±ÉÇ" ;;
	esac
	[ "$cpu" ] && printf "$icon"
}

cut() {
	IFS=$2
	set -- $1
	printf '%s' "$@"
}

dpm() {
	case "$(xset q | grep '^\s*DPMS is' | awk '{print $3}')" in
		Disabled ) printf "Ó∞ï" ;;
	esac
}

ime() {
	ime="$(fcitx5-remote -n)"
	case "$ime" in
		*anthy*|*kkc*|*mozc*|*skk* ) icon="üáØüáµ" ;;
		*bi*|*ma*|*pin*            ) icon="üá®üá≥" ;;
		*hangul*                   ) icon="üá∞üá∑" ;;
		*                          ) icon="üá∫üá∏" ;;
	esac
	[ "$ime" ] && printf "$icon"
}

net() {
	net="$(iwctl station wlan0 show | grep '^\s*RSSI' | awk '{print $2}')"
	case 1 in
		$((net <= -80)) ) icon="Û∞§Ø" ;;
		$((net <= -70)) ) icon="Û∞§ü" ;;
		$((net <= -60)) ) icon="Û∞§¢" ;;
		$((net <= -50)) ) icon="Û∞§•" ;;
		$((net >= -50)) ) icon="Û∞§®" ;;
	esac
	case "$(cat /sys/class/net/w*/operstate 2>/dev/null)" in
		down ) icon="Û∞§Æ" ;;
	esac
	case "$(cat /sys/class/net/e*/operstate 2>/dev/null)" in
		*up* ) icon="Û∞àÄ" ;;
	esac
	[ "$net" ] && printf "$icon"
}

usb() {
	usb="$(df | grep '/media/')"
	[ "$usb" ] && printf "Û∞ïì"
}

vol() {
	vol="$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
	vol="${vol#'Volume: '}"
	vol="${vol%' [MUTED]'}"
	vol="$(printf "%.0f" "$(cut "$vol" ".")")"
	case 1 in
		$((vol <= 10)) ) icon="Û∞ïø" ;;
		$((vol <= 80)) ) icon="Û∞ñÄ" ;;
		$((vol >= 80)) ) icon="Û∞ïæ" ;;
	esac
	case "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)" in
		*MUTED* ) icon="Û∞ùü" ;;
	esac
	[ "$vol" ] && printf "$icon"
}

case "$START" in
	*dwm*)
		while true; do
			sleep 0.5 && xprop -root -set WM_NAME " $(ime) $(usb)$(dpm)$(cpu)$(bat)$(net)$(vol) $(clk) "
		done
		;;
	*)
		printf "$(bat) $(net) $(vol)"
		;;
esac
