#!/bin/sh

bat() {
	bat="$(cat /sys/class/power_supply/BAT0/capacity)"
	case "$bat" in
		$((bat >= 100)) ) icon="󰁹" ;;
		$((bat >= 90)) ) icon="󰂂" ;;
		$((bat >= 80)) ) icon="󰂁" ;;
	esac
	[ "$bat" ] && printf " $icon  $bat%%"
}

clk() {
	printf " 󰥔  %s " "$(date '+%H:%M')"
}

cpu() {
	cpu="$(sed 's/000$/°C/' /sys/class/thermal/thermal_zone0/temp)"
	[ "$cpu" ] && printf " 󰔏  %s " "$cpu"
}

cut() {
	IFS=$2
	set -- $1
	printf '%s' "$@"
}

net() {
	net="$(iwctl station wlan0 show | grep "^\s*Connected network" | awk '{print $3}')"
	case "$(cat /sys/class/net/wl*/operstate 2>/dev/null)" in
		up   ) printf " 󰤨  %s " "$net" ;;
		down ) printf " 󰤭  %s " "Disconnected" ;;
	esac
}

vol() {
	vol="$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
	vol="${vol#'Volume: '}"
	vol="${vol%' [MUTED]'}"
	vol="$(printf "%.0f" "$(cut "$vol" ".")")"
	case "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)" in
		*MUTED* ) printf " 󰝟  %s " "$vol" ;;
		*       ) printf " 󰕾  %s " "$vol" ;;
	esac
}

while true; do
	sleep 0.5 && xprop -root -set WM_NAME "$(cpu) $(bat) $(net) $(vol) $(clk)"
done
