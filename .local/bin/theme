#!/bin/sh

get() {
	theme=$(awk '{print $1; exit}' "$config")
	if [ "$theme" == "auto" ]; then
		if [[ "$(date +%H:%M)" < "06:00" ]] || [[ "$(date +%H:%M)" > "18:00" ]]; then
			theme="dark"
		else
			theme="light"
		fi
	fi
	echo "$theme"
}

setup() {
	get
	if [ "$QT_STYLE_OVERRIDE" == "Windows" ]; then
		COLOR_SCHEME="prefer-light"
		GTK_THEME="Chicago95"
		ICON_THEME="Chicago95"
		XCURSOR_THEME="Chicago95 Standard Cursors"
		KBD_BACKLIGHT="0"
	elif [ "$theme" == "dark" ]; then
		COLOR_SCHEME="prefer-dark"
		GTK_THEME="Adwaita-dark"
		ICON_THEME="Adwaita"
		XCURSOR_THEME="Bibata-Modern-Classic"
		KBD_BACKLIGHT="1"
	else
		COLOR_SCHEME="prefer-light"
		GTK_THEME="Adwaita"
		ICON_THEME="Adwaita"
		XCURSOR_THEME="Bibata-Modern-Ice"
		KBD_BACKLIGHT="0"
	fi
	gsettings set org.gnome.desktop.interface color-scheme "$COLOR_SCHEME"
	gsettings set org.gnome.desktop.interface cursor-theme "$XCURSOR_THEME"
	gsettings set org.gnome.desktop.interface gtk-theme "$GTK_THEME"
	gsettings set org.gnome.desktop.interface icon-theme "$ICON_THEME"
	brightnessctl -sd *:kbd_backlight set "$KBD_BACKLIGHT"
	echo -e "cursor {\n\txcursor-theme \"$XCURSOR_THEME\"\n}" > ~/.config/niri/cursor.kdl
	hyprctl setcursor "$XCURSOR_THEME"
	pywalfox "${COLOR_SCHEME#*-}"
	bar
	wallpaper random
}

auto() {
	echo "auto" > "$config"
	setup
}

dark() {
	echo "dark" > "$config"
	setup
}

light() {
	echo "light" > "$config"
	setup
}

help() {
	echo "Usage: theme [get|setup|auto|dark|light|help]"
}

config="$HOME/.config/theme"

case "$@" in
	setup|auto|dark|light|help ) $@ ;;
	*                          ) get ;;
esac
