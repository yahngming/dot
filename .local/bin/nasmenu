#!/bin/sh

# Browse for mDNS/DNS-SD services using the Avahi daemon...
srvname=$(avahi-browse _smb._tcp -t | awk '{print $4}' | dmenu) || exit 1
notify-send "Searching for network shares..."

# Choose share disk...
share=$(smbclient -L "$srvname" -N | grep Disk | awk '{print $1}' | dmenu) || exit 1

# Format URL...
share2mnt=//"$srvname".local/"$share"

username=$(dmenu -p "Username:")
password=$(dmenu -p "Password:" -P)

sharemount() {
	mounted=$(mount -v | grep "$share2mnt") || ([ ! -d /mnt/"$share" ] && sudo mkdir /mnt/"$share")
	[ -z "$mounted" ] && sudo mount -t cifs "$share2mnt" /mnt/"$share" -o username=$username,password=$password && notify-send "$share mounted." && exit 0
	notify-send "$share already mounted."; exit 1
}

sharemount
