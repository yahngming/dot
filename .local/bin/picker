#!/bin/sh

set -e

if [ "$6" -ge 4 ]; then
	set -x
fi

multiple="$1"
directory="$2"
save="$3"
path="$4"
out="$5"

case "$TERMINAL" in
	foot ) opt="-a" ;;
	st   ) opt="-c" ;;
esac
termcmd="$TERMINAL $opt center -T 'termfilechooser' -e"
cmd="lf"
command="$termcmd $cmd"

if [ "$save" = "1" ]; then
	set -- -selection-path "$out" "$path"
elif [ "$directory" = "1" ]; then
	set -- -last-dir-path "$out" "$path"
elif [ "$multiple" = "1" ]; then
	set -- -selection-path "$out" "$path"
else
	set -- -selection-path "$out" "$path"
fi

if [ "$BROWSER" = "qutebrowser" ]; then
	command="$command"
else
	for arg in "$@"; do
		escaped=$(printf "%s" "$arg" | sed 's/"/\\"/g')
		command="$command \"$escaped\""
	done
fi

sh -c "$command"
