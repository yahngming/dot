#!/bin/sh

case "$TERMINAL" in
	foot ) opt="-a" ;;
	st   ) opt="-c" ;;
esac
termcmd="$TERMINAL $opt center -T 'termfilechooser' -e"
cmd="lf"
command="$termcmd $cmd"

if [ "$BROWSER" = "qutebrowser" ]; then
	$SHELL -c "$command $@"
	exit
fi

set -e

if [ "$6" -ge 4 ]; then
	set -x
fi

multiple="$1"
directory="$2"
save="$3"
path="$4"
out="$5"

if [ "$save" = "1" ]; then
	set -- -selection-path "$out" "$path"
elif [ "$directory" = "1" ]; then
	set -- -last-dir-path "$out" "$path"
elif [ "$multiple" = "1" ]; then
	set -- -selection-path "$out" "$path"
else
	set -- -selection-path "$out" "$path"
fi

for arg in "$@"; do
	escaped=$(printf "%s" "$arg" | sed 's/"/\\"/g')
	command="$command \"$escaped\""
done

sh -c "$command"
