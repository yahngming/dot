#!/bin/sh

screensavers=(
	"asciiquarium -s -t"
	"neo-matrix -s"
	"lavat -c red -R 1 -k magenta"
	"ttesvr"
	"ttysvr"
)

off() {
	if [ -n "$WAYLAND_DISPLAY" ]; then
		hyprctl dispatch dpms on
	fi
	brightnessctl -r
	for screensaver in "${screensavers[@]}"; do
		pkill -f "$screensaver"
	done
	pkill screensaver
}

on() {
	if pgrep locker || pgrep screensaver; then
		exit
	elif [ -f ~/.config/screenblank ] || [ "$(cat /sys/class/power_supply/AC/online 2>/dev/null)" == "0" ] && [ -n "$WAYLAND_DISPLAY" ]; then
		hyprctl dispatch dpms off
	elif [ -f ~/.config/screendim ]; then
		brightnessctl -s set 10
	elif [ -f ~/.config/screensaver ]; then
		while true; do
			screensaver=${screensavers[$(($RANDOM%${#screensavers[@]}))]}
			read -r -a command <<< "$screensaver"
			if command -v "${command[0]}"; then
				eval "tui $screensaver &"
				exit
			fi
		done
	fi
}

help() {
	echo "Usage: screensaver [MODE]"
	echo "  off        turn off screensaver"
	echo "  on         start screensaver"
}

mode=${1:-help}
$mode
