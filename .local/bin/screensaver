#!/bin/sh

screensavers=(
	"$TERMINAL -F -e asciiquarium"
	"$TERMINAL -F -e cmatrix"
	"$TERMINAL -F -e lavat -c red -R 1 -k magenta"
	"$TERMINAL -F -e pipes.sh -R"
	"$TERMINAL -F -e ttysvr"
)

dim() {
	brightnessctl -s set 10
	brightnessctl -sd tpacpi::kbd_backlight set 0
}

off() {
	rm -f ~/.config/screensaver
	for screensaver in "${screensavers[@]}"; do
		if pgrep -fx "$screensaver"; then
			pkill -fx "$screensaver"
			exit
		fi
	done
	brightnessctl -r
	brightnessctl -rd tpacpi::kbd_backlight
}

on() {
	if [ ! -f ~/.config/screensaver ]; then
		touch -f ~/.config/screensaver
		eval "${screensavers[$(($RANDOM%${#screensavers[@]}))]}"
	fi
}

help() {
	echo "Usage: screensaver [MODE]"
	echo "  dim       dim the screen"
	echo "  off       turn off screensaver and bring up the brightness"
	echo "  on        start a random screensaver"
}

mode=${1:-help}
$mode
