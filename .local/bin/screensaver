#!/bin/sh

screensavers=(
	"$TERMINAL -F -e asciiquarium -s -t"
	"$TERMINAL -F -e neo-matrix -s"
	"$TERMINAL -F -e lavat -c red -R 1 -k magenta"
	"$TERMINAL -F -e pipes.sh -R"
	"$TERMINAL -F -e ttysvr"
	"while true; do tte -i ~/.config/fastfetch/arch.txt --frame-rate 240 --canvas-width 0 --canvas-height $(($(tput lines) - 2)) --anchor-canvas c --anchor-text c $(tte 2>&1 | grep -oP '{\K[^}]+' | tr ',' ' ' | tr ' ' '\n' | sed -n '/^beams$/,$p' | sort -u | shuf -n1); done"
)

for screensaver in "${screensavers[@]}"; do
	if pgrep -fx "$screensaver"; then
		break
	fi
	unset screensaver
done

off() {
	brightnessctl -r
	pkill -fx "$screensaver"
}

on() {
	if [ -f ~/.config/screendim ]; then
		brightnessctl -s set 10
	elif [ -f ~/.config/screensaver ] && [ -z "$screensaver" ]; then
		eval "${screensavers[$(($RANDOM%${#screensavers[@]}))]}"
	fi
}

help() {
	echo "Usage: screensaver [MODE]"
	echo "  off        turn off screensaver"
	echo "  on         start screensaver"
}

mode=${1:-help}
$mode
