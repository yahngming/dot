#!/bin/sh

disable() {
	if [ -f ~/.config/proxy ]; then
		rm -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "none"
		sudo systemctl stop sing-box.service
		sudo systemctl disable sing-box.service
	fi
}

enable() {
	sudo cp ~/.local/src/sub/singbox /etc/sing-box/config.json
	sudo chown sing-box:sing-box /etc/sing-box/config.json
	sudo chmod 640 /etc/sing-box/config.json
	if [ ! -f ~/.config/proxy ]; then
		touch -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "manual"
		sudo systemctl start sing-box.service
		sudo systemctl enable sing-box.service
	else
		sudo systemctl restart sing-box.service
	fi
}

help() {
	echo "Usage: proxy [MODE]"
	echo "  disable        disable proxy"
	echo "  enable         enable/reload proxy"
}

mode=${1:-help}
$mode
