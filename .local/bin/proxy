#!/bin/sh

disable() {
	if [ -f ~/.config/proxy ]; then
		rm -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "none"
		sudo systemctl stop sing-box.service
		sudo systemctl disable sing-box.service
	fi
}

enable() {
	if [ ! -f ~/.config/proxy ]; then
		touch -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "manual"
		sudo systemctl enable sing-box.service
		sudo systemctl start sing-box.service
	fi
}

reload() {
	if [ -f ~/.config/proxy ]; then
		sudo cp ~/.local/src/sub/singbox /etc/sing-box/config.json
		sudo chown sing-box:sing-box /etc/sing-box/config.json
		sudo chmod 640 /etc/sing-box/config.json
		sudo systemctl enable sing-box.service
		sudo systemctl restart sing-box.service
	fi
}

help() {
	echo "Usage: proxy [MODE]"
	echo "  disable        disable proxy"
	echo "  enable         enable proxy"
	echo "  reload         update config and restart"
}

mode=${1:-help}
$mode
