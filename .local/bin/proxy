#!/bin/sh

off() {
	if [ -f ~/.config/proxy ]; then
		rm -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "none"
		sudo systemctl stop mihomo.service
		sudo systemctl disable mihomo.service
	fi
}

on() {
	cd ~/.local/src/sub
	git pull
	sudo cp ~/.local/src/sub/clash /etc/mihomo/config.yaml
	if [ ! -f ~/.config/proxy ]; then
		touch -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "manual"
		sudo systemctl start mihomo.service
		sudo systemctl enable mihomo.service
	else
		sudo systemctl restart mihomo.service
	fi
}

help() {
	echo "Usage: proxy [MODE]"
	echo "  off        disable proxy"
	echo "  on         enable/reload proxy"
}

case "$@" in
	off|on ) $@ ;;
	*      ) help ;;
esac
