#!/bin/sh

off() {
	if [ -f ~/.config/proxy ]; then
		rm -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "none"
		sudo systemctl disable --now sing-box.service
	fi
}

on() {
	cd ~/.local/src/sub
	git pull
	cd - >/dev/null 2>&1
	sudo cp ~/.local/src/sub/sing-box /etc/sing-box/config.json
	sudo cp ~/.local/src/sub/sing-box /etc/sing-box/config.yaml
	if [ ! -f ~/.config/proxy ]; then
		touch -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "manual"
		sudo systemctl enable --now sing-box.service
	else
		sudo systemctl restart sing-box.service
	fi
}

status() {
	echo "sing-box $(systemctl is-active sing-box.service)"
}

help() {
	echo "Usage: proxy [off|on]"
}

case "$@" in
	off|on|help ) $@ ;;
	*           ) status ;;
esac
