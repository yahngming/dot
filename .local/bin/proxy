#!/bin/sh

off() {
	if [ -f ~/.config/proxy ]; then
		rm -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "none"
		sudo systemctl stop $PROXY.service
		sudo systemctl disable $PROXY.service
	fi
}

on() {
	cd ~/.local/src/sub
	git pull
	cd - >/dev/null 2>&1
	sudo cp ~/.local/src/sub/$PROXY /etc/$PROXY/config.json
	sudo cp ~/.local/src/sub/$PROXY /etc/$PROXY/config.yaml
	if [ ! -f ~/.config/proxy ]; then
		touch -f ~/.config/proxy
		gsettings set org.gnome.system.proxy mode "manual"
		sudo systemctl start $PROXY.service
		sudo systemctl enable $PROXY.service
	else
		sudo systemctl restart $PROXY.service
	fi
}

help() {
	echo "Usage: proxy [MODE]"
	echo "  off        disable/stop proxy"
	echo "  on         enable/start proxy"
}

case "$@" in
	off|on ) $@ ;;
	*      ) help ;;
esac
