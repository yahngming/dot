#!/bin/sh

wallpaper=$(find ~/Pictures/wallpapers/* | shuf -n 1)
wal -n -i $wallpaper
source ~/.cache/wal/colors.sh
sed -i '/background = /s/.*/    background = "'$color0'"/' ~/.config/dunst/dunstrc
sed -i '/foreground = /s/.*/    foreground = "'$color7'"/' ~/.config/dunst/dunstrc
sed -i '/frame_color = /s/.*/    frame_color = "'$color3'"/' ~/.config/dunst/dunstrc
sed -i "s/background-color=.*/background-color=$color0/" "$HOME/.config/mako/config"
sed -i "s/border-color=.*/border-color=$color3/" "$HOME/.config/mako/config"
sed -i "s/text-color=.*/text-color=$color7/" "$HOME/.config/mako/config"

if [ -n "$WAYLAND_DISPLAY" ]; then
	hyprctl hyprpaper unload all
	hyprctl hyprpaper preload $wallpaper
	hyprctl hyprpaper wallpaper ,$wallpaper
	pkill waybar && hyprctl dispatch exec waybar
	makoctl reload
elif [ -n "$DISPLAY" ]; then
	xwallpaper --zoom $wallpaper
	xdo key_press -k 133; xdo key_press -k 71; sleep 0.2; xdo key_release -k 71; xdo key_release -k 133
fi
