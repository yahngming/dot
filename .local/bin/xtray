#!/bin/sh

bat() {
	printf "  "
	printf " $(cat /sys/class/power_supply/BAT0/capacity)"
}

brt() {
	printf "  "
	printf " %.0f\n" $(cat /sys/class/backlight/*/brightness)
}

clk() {
	printf " 󰥔 "
	printf " $(date '+%H:%M') "
}

cpu() {
	cpu="$(sed 's/000$/°C/' /sys/class/thermal/thermal_zone0/temp)"
	[ "$cpu" ] && printf "  %s" " $cpu "
}

cut() {
	IFS=$2
	set -- $1
	printf '%s' "$@"
}

net() {
	net="$(iw dev "${1:?}" info | grep ssid | cut -d ' ' -f2- )"
	case "$(cat /sys/class/net/wl*/operstate 2>/dev/null)" in
		up   ) printf " 󰤨 %s" " $net " ;;
		down ) printf " 󰤭 %s" " Disconnected " ;;
	esac
}

vol() {
	vol="$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
	vol="${vol#Volume: }"
	vol="$(printf "%.0f" "$(cut "$vol" ".")")"
	printf " 󰕾 "
	printf " $vol "
}

while true; do
	sleep 1 && xprop -root -set WM_NAME "$(cpu) $(net) $(vol) $(clk)"
done
