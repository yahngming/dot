set autoindent
set background=dark
set backspace=indent,eol,start
set backupdir=/tmp//
set clipboard=unnamedplus
set complete+=kspell
set directory=/tmp//
set encoding=utf8
set hlsearch
set ignorecase
set incsearch
set laststatus=1
set listchars=space:·,tab:>·
set mouse=a
set number
set omnifunc=syntaxcomplete#Complete
set relativenumber
set runtimepath^=~/.local/share/vim
set shiftwidth=8
set showmatch
set smartcase
set statusline=%#StatusLine#\ %{mode()}\ %#ModeMsg#\ %F%y%r%m\ %=\ %{&fileencoding}\ %#StatusLine#\ %p%%\ %l/%L,%c/%{col('$')-1}\ 
set tabstop=8
set termguicolors
set title
set titlestring=%t(%f)
set undodir=/tmp//
set viminfo='10,<100,:100,%,n~/.local/state/vim/viminfo
set wildmenu

filetype indent on
filetype plugin on
syntax on

map <Space> <Leader>
map <Leader>. :set list!<CR>
map <Leader>/ :nohlsearch<CR>
map <Leader>a ggVG
map <leader>f :LF<CR>
map <Leader>o :Files<CR>
map <Leader>q :q!<CR>
map <Leader>t :NERDTreeToggle<CR>
map <Leader>w :w!<CR>

autocmd BufEnter * if tabpagenr('$') == 1 && winnr('$') == 1 && exists('b:NERDTree') && b:NERDTree.isTabTree() | quit | endif
autocmd BufReadPost * if line("'\"") > 1 && line("'\"") <= line("$") | exe "normal! g'\"" | endif
autocmd FocusGained,BufEnter * silent! checktime
autocmd VimEnter * if len(filter(values(g:plugs), '!isdirectory(v:val.dir)')) | PlugInstall --sync | source $MYVIMRC | endif
autocmd VimLeave * mksession! ~/.local/state/vim/vimsession

if empty(glob('~/.local/state/vim'))
	silent !mkdir -p ~/.local/state/vim
endif

if empty(glob('~/.local/share/vim/autoload/plug.vim'))
	silent !curl -fLo ~/.local/share/vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
endif

function! LF()
    let temp = tempname()
    exec 'silent !lf -selection-path=' . shellescape(temp)
    if !filereadable(temp)
        redraw!
        return
    endif
    let names = readfile(temp)
    if empty(names)
        redraw!
        return
    endif
    exec 'edit ' . fnameescape(names[0])
    for name in names[1:]
        exec 'argadd ' . fnameescape(name)
    endfor
    redraw!
endfunction
command! -bar LF call LF()

call plug#begin()
Plug 'ap/vim-css-color'
Plug 'itchyny/vim-cursorword'
Plug 'jasonccox/vim-wayland-clipboard'
Plug 'junegunn/fzf'
Plug 'junegunn/fzf.vim'
Plug 'mg979/vim-visual-multi'
Plug 'mhinz/vim-startify'
Plug 'preservim/nerdtree'
Plug 'tpope/vim-surround'
call plug#end()
