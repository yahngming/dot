[[ $- != *i* ]] && return

[[ -f ~/.cache/wal/sequences ]] && (cat ~/.cache/wal/sequences &)
[[ -f /usr/share/git/completion/git-prompt.sh ]] && . /usr/share/git/completion/git-prompt.sh

_fzf_compgen_path() {
	fd --exclude ".git" . "$1" --follow --hidden
}

_fzf_compgen_dir() {
	fd --exclude ".git" . "$1" --follow --hidden --type directory
}

_fzf_comprun() {
	local command=$1
	shift
	case "$command" in
		cd           ) fzf --preview "eza --color=always --tree {} | head -200" "$@" ;;
		export|unset ) fzf --preview "eval 'echo \$'{}" "$@" ;;
		ssh          ) fzf --preview "dig {}" "$@" ;;
		*            ) fzf --preview "if [ -d {} ]; then eza --color=always --tree {} | head -200; else bat --color=always --line-range :500 --number {}; fi" "$@" ;;
	esac
}

proxy() {
	PROXY_ENV="all_proxy ALL_PROXY ftp_proxy FTP_PROXY http_proxy HTTP_PROXY https_proxy HTTPS_PROXY"
	for envar in $PROXY_ENV; do
		export $envar="http://127.0.0.1:7890"
	done
	gsettings set org.gnome.system.proxy mode "manual"
}

theme() {
	case "$XDG_VTNR" in
		1)
			export GUI="Hyprland"
			export LAUNCHER="fuzzel"
			export TERMINAL="foot"
			if [ -f ~/.config/dark ]; then
				export COLOR_SCHEME="prefer-dark"
				export GTK_THEME="Adwaita-dark"
				export HYPRCURSOR_THEME="Bibata-Modern-Ice"
				export ICON_THEME="Adwaita"
				export XCURSOR_THEME="Bibata-Modern-Ice"
			else
				export COLOR_SCHEME="prefer-light"
				export GTK_THEME="Adwaita"
				export HYPRCURSOR_THEME="Bibata-Modern-Classic"
				export ICON_THEME="Adwaita"
				export XCURSOR_THEME="Bibata-Modern-Classic"
			fi
			;;
		2)
			export COLOR_SCHEME="prefer-dark"
			export GTK_THEME="Adwaita-dark"
			export GUI="startx ~/.config/xorg/xinitrc dwm"
			export ICON_THEME="Adwaita"
			export LAUNCHER="dmenu"
			export TERMINAL="st"
			export XCURSOR_THEME="Bibata-Modern-Ice"
			;;
		3)
			export COLOR_SCHEME="prefer-light"
			export GTK_THEME="Chicago95"
			export GUI="startx ~/.config/xorg/xinitrc xfce"
			export ICON_THEME="Chicago95"
			export LAUNCHER="xfce4-appfinder"
			export QT_STYLE_OVERRIDE="Windows"
			export TERMINAL="xfce4-terminal"
			export XCURSOR_THEME="Chicago95 Standard Cursors"
			;;
	esac
	case "$LAUNCHER" in
		fuzzel ) export MENU="fuzzel --dmenu" ;;
		rofi   ) export MENU="rofi -dmenu" ;;
		walker ) export MENU="walker --dmenu --keepsort" ;;
		*      ) export MENU="dmenu" ;;
	esac
	gsettings set org.gnome.desktop.interface color-scheme "$COLOR_SCHEME"
	gsettings set org.gnome.desktop.interface cursor-theme "$XCURSOR_THEME"
	gsettings set org.gnome.desktop.interface gtk-theme "$GTK_THEME"
	gsettings set org.gnome.desktop.interface icon-theme "$ICON_THEME"
}

[[ ":$PATH:" != *":$HOME/.local/bin:"* ]] && PATH="$HOME/.local/bin:$PATH"

export BROWSER="chrome"
export EDITOR="vim"
export FZF_DEFAULT_COMMAND="fd --exclude .git --follow --hidden --strip-cwd-prefix"
export FZF_CTRL_T_COMMAND="fd --exclude .git --follow --hidden --strip-cwd-prefix --type file"
export FZF_ALT_C_COMMAND="fd --exclude .git --follow --hidden --strip-cwd-prefix --type directory"
export FZF_CTRL_T_OPTS="--preview 'if [ -d {} ]; then eza --color=always --tree {} | head -200; else bat --color=always --line-range :500 --number {}; fi'"
export FZF_ALT_C_OPTS="--preview 'eza --color=always --tree {} | head -200'"
export GTK2_RC_FILES="$HOME/.config/gtk-2.0/gtkrc"
export HISTCONTROL="ignoreboth:erasedups"
export LESS="-IR"
export OPENER="xdg-open"
export PAGER="less"
export QT_IM_MODULE="fcitx"
export QT_QPA_PLATFORMTHEME="gtk3"
export SDL_IM_MODULE="fcitx"
export SUDO_ASKPASS="$HOME/.local/bin/sapmenu"
export W3M_DIR="$HOME/.config/w3m"
export XMODIFIERS="@im=fcitx"

PS1="\[$(tput sc; tput setaf 3; printf '%*s' $COLUMNS $(__git_ps1); tput rc)\]\[$(tput setaf 2)\]\u@\h:\[$(tput setaf 1)\]\w>\[$(tput sgr0)\] "

alias ll="eza --all --color=always --git --git-repos --group-directories-first --icons=always --long"
alias sudo="sudo "

eval "$(fzf --bash)"
eval "$(zoxide init bash)"

if [ -z "$DISPLAY" ]; then
	proxy
	theme
	exec "$GUI"
else
	fastfetch | lolcat
fi
